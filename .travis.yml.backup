# See the following URL for
# https://docs.travis-ci.com/user/customizing-the-build/
#
sudo: true

# whitelist
branches:
  only:
    - master
    - develop

notifications:
  slack: ibmswift:RHkwcHYh4kkYVRVzm9nZk5TF

env:
  global:
    - DOCKER_HOST=tcp://9.41.51.206:2375
    - DOCKER_PORT_RANGE=2400:2500
    - SLIRP_PORTS=$(seq 2375 2500)

before_install:
  - sudo sh -c "apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D"
  # - sudo sh -c "apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D"
  - sudo sh -c "echo deb https://apt.dockerproject.org/repo ubuntu-precise main > /etc/apt/sources.list.d/docker.list"
  # - sudo echo $TRAVIS_BUILD_DIR
  # - sudo curl -s -XGET http://9.41.51.206:2375/images/search?term=elasticsearch
  # - sudo echo -e "Host github.ibm.com\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
  # - sudo cat ~/.ssh/config
  # - sudo git clone -b master git@github.ibm.com:ibmswift/IncludeChanges.git ibmswift/IncludeChanges

install:
  - sudo apt-get -qqy update
  - sudo apt-get -qqy install docker-engine || true
  - sudo sudo usermod -aG docker "$USER"
  - docker login -e $DOCKER_HUB_EMAIL -u $DOCKER_HUB_USERID -p $DOCKER_HUB_PWD
  - docker pull milbuild/ubuntu-swift-phoenix:latest

script:
  - echo "About to run docker container to build and test Phoenix for branch '$TRAVIS_BRANCH'."
  - docker run --rm -e PHOENIX_BRANCH=$TRAVIS_BRANCH milbuild/ubuntu-kitura:latest
  - echo "Build and tests completed. See above for status."
